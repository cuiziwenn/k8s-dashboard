{% extends 'base.html' %}
{% block title %}Ingress管理{% endblock %}
{% block content %}
<div class="card">
    <h2 class="card-title">Ingress 管理</h2>
    <div style="margin-bottom: 2rem;">
        <label>选择命名空间：</label>
        <select onchange="location.href='?namespace='+this.value" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #e0e0e0;">
            {% for ns in namespaces %}
            <option value="{{ ns.metadata.name }}" {% if ns.metadata.name == current_namespace %}selected{% endif %}>
                {{ ns.metadata.name }}
            </option>
            {% endfor %}
        </select>
    </div>
    <table>
        <thead>
            <tr>
                <th>名称</th>
                <th>主机</th>
                <th>路径</th>
                <th>服务</th>
                <th>创建时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for ing in ingresses %}
            <tr>
                <td><strong>{{ ing.metadata.name }}</strong></td>
                <td>
                    {% for rule in ing.spec.rules %}
                    {{ rule.host }}<br>
                    {% endfor %}
                </td>
                <td>
                    {% for rule in ing.spec.rules %}
                    {% for path in rule.http.paths %}
                    {{ path.path }}<br>
                    {% endfor %}
                    {% endfor %}
                </td>
                <td>
                    {% for rule in ing.spec.rules %}
                    {% for path in rule.http.paths %}
                    {{ path.backend.service.name }}:{{ path.backend.service.port.number }}<br>
                    {% endfor %}
                    {% endfor %}
                </td>
                <td>{{ ing.metadata.creation_timestamp|date:"Y-m-d H:i:s" }}</td>
                <td>
                    <a href="/ingresses/delete/{{ current_namespace }}/{{ ing.metadata.name }}/" 
                       class="btn btn-danger" onclick="return confirm('确认删除?')">删除</a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" style="text-align: center; color: #999;">暂无数据</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
